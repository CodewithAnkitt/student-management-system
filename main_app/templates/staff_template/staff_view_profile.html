{% extends 'main_app/base.html' %}
{% load static %}
{% block page_title %}{{page_title}}{% endblock page_title %}

{% block content %}

<section class="content">
    <div class="container-fluid">
        <!-- Profile Details Card -->
        <div class="row">
            <div class="col-md-12">
                <div class="card card-primary">
                    <div class="card-header">
                        <h3 class="card-title">Profile Details</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-warning btn-sm" id="toggleEditForm">
                                <i class="fas fa-edit"></i> Edit Profile
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 text-center">
                                <img src="{{ request.user.profile_pic }}" class="img-fluid rounded-circle" style="max-width: 200px; border: 3px solid #007bff;" alt="Profile Picture">
                            </div>
                            <div class="col-md-9">
                                <table class="table table-bordered table-striped">
                                    <tr>
                                        <th style="width: 30%"><i class="fas fa-user"></i> First Name</th>
                                        <td>{{ request.user.first_name }}</td>
                                    </tr>
                                    <tr>
                                        <th><i class="fas fa-user"></i> Last Name</th>
                                        <td>{{ request.user.last_name }}</td>
                                    </tr>
                                    <tr>
                                        <th><i class="fas fa-envelope"></i> Email</th>
                                        <td>{{ request.user.email }}</td>
                                    </tr>
                                    <tr>
                                        <th><i class="fas fa-venus-mars"></i> Gender</th>
                                        <td>{% if request.user.gender == 'M' %}Male{% else %}Female{% endif %}</td>
                                    </tr>
                                    <tr>
                                        <th><i class="fas fa-book"></i> Course</th>
                                        <td>{{ request.user.staff.course.name }}</td>
                                    </tr>
                                    <tr>
                                        <th><i class="fas fa-road"></i> Street</th>
                                        <td>{{ request.user.street|default:"Not provided" }}</td>
                                    </tr>
                                    <tr>
                                        <th><i class="fas fa-city"></i> City</th>
                                        <td>{{ request.user.city|default:"Not provided" }}</td>
                                    </tr>
                                    <tr>
                                        <th><i class="fas fa-map-marked-alt"></i> State</th>
                                        <td>{{ request.user.state|default:"Not provided" }}</td>
                                    </tr>
                                    <tr>
                                        <th><i class="fas fa-mail-bulk"></i> PIN Code</th>
                                        <td>{{ request.user.pin_code|default:"Not provided" }}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Profile Form (Hidden by default) -->
        <div class="row" id="editFormSection" style="display: none;">
            <div class="col-md-12">
                <div class="card card-warning">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-edit"></i> Edit Profile</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-secondary btn-sm" id="cancelEdit">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>
                    {% include "main_app/form_template.html" with messages=messages form=form button_text="Update Profile"%}
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock content %}

{% block custom_js %}
  <script>
      $(document).ready(function(){
            var ifNotfied = false;
            
            // Toggle edit form
            $("#toggleEditForm").click(function(){
                $("#editFormSection").slideToggle();
                $('html, body').animate({
                    scrollTop: $("#editFormSection").offset().top - 100
                }, 500);
            });
            
            // Cancel edit
            $("#cancelEdit").click(function(){
                $("#editFormSection").slideUp();
                $('html, body').animate({
                    scrollTop: 0
                }, 500);
            });
            
            // Password change alert
            $("#id_password").on("change", function(){
                if (!ifNotfied){
                    ifNotfied = true;
                    alert("After a successful profile update:\n\nYour session would be terminated\nYou would be required to login again")
                }
            });
      });
  </script>
{% endblock custom_js %}
