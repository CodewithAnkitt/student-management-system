{% extends 'main_app/base.html' %}
{% load static %}
{% block page_title %}{{page_title}}{% endblock page_title %}

{% block custom_css %}
<style>
    /* Modern Color Scheme with Custom Background */
    .content-wrapper {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%) !important;
    }
    
    /* Dashboard Cards - Vibrant Colors */
    .small-box.bg-gradient-purple {
        background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%) !important;
        color: white;
    }
    
    .small-box.bg-gradient-blue {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%) !important;
        color: white;
    }
    
    .small-box.bg-gradient-orange {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%) !important;
        color: white;
    }
    
    .small-box.bg-gradient-green {
        background: linear-gradient(135deg, #27ae60 0%, #229954 100%) !important;
        color: white;
    }
    
    .small-box {
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .small-box:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .small-box .icon {
        font-size: 70px;
        opacity: 0.3;
    }
    
    .small-box-footer {
        background: rgba(0,0,0,0.1) !important;
        color: white !important;
        border-radius: 0 0 15px 15px;
    }
    
    .small-box-footer:hover {
        background: rgba(0,0,0,0.2) !important;
        color: white !important;
    }
    
    .card.card-modern-purple {
        border-top: 3px solid #8e44ad;
        box-shadow: 0 2px 10px rgba(142, 68, 173, 0.2);
        background: white;
    }
    
    .card.card-modern-purple .card-header {
        background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%);
        color: white;
        border-radius: 0;
    }
    
    .card.card-modern-blue {
        border-top: 3px solid #3498db;
        box-shadow: 0 2px 10px rgba(52, 152, 219, 0.2);
        background: white;
    }
    
    .card.card-modern-blue .card-header {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        border-radius: 0;
    }
</style>
{% endblock custom_css %}

{% block content %}
<section class="content">
    <div class="container-fluid">
        <!-- Small boxes (Stat box) -->
        <div class="row">
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-gradient-purple">
                    <div class="inner">
                        <h3>{{total_students}}</h3>
                        <p>Total Students</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <a href="{% url 'manage_student' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-gradient-blue">
                    <div class="inner">
                        <h3>{{total_staff}}</h3>
                        <p>Total Faculty</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-chalkboard-teacher"></i>
                    </div>
                    <a href="{% url 'manage_staff' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-gradient-orange">
                    <div class="inner">
                        <h3>{{total_course}}</h3>
                        <p>Total Course</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <a href="{% url 'manage_course' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-gradient-green">
                    <div class="inner">
                        <h3>{{total_subject}}</h3>
                        <p>Total Subjects</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <a href="{% url 'manage_subject' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <!-- ./col -->
        </div>
        <!-- /.row -->
        <!-- Main row -->
        <div class="row">
            <div class="col-md-6">
                <!-- PIE CHART -->
                <div class="card card-modern-purple">
                  <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-chart-pie mr-2"></i>Students vs Faculty Distribution</h3>
    
                    <div class="card-tools">
                      <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
                      </button>
                      <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="chart">
                      <canvas id="pieChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                    </div>
                  </div>
                </div>
                <!-- /.card -->
            </div>
            <div class="col-md-6">
                <div class="card card-modern-blue">
                  <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-chart-bar mr-2"></i>Attendance Per Subject</h3>

                    <div class="card-tools">
                      <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
                      </button>
                      <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="chart">
                      <canvas id="barChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                    </div>
                  </div>
                  <!-- /.card-body -->
                </div>
            </div>
            <!-- right col -->
        </div>
        <!-- /.row (main row) -->
    </div><!-- /.container-fluid -->
</section>
{% endblock content %}

{% block chart_js %}
<script src="{% static 'plugins/chart.js/Chart.min.js'%}"></script>
{% endblock chart_js %}

{% block custom_js %}
  <script>
      $(document).ready(function(){
        var donutData        = {
            labels: ['Students', 'Faculty'],
            datasets: [
              {
                data:[{{total_students}}, {{total_staff}}],
                backgroundColor : ['#3498db', '#2c3e50'],  // Bright blue for students, dark slate for faculty
                borderWidth: 2,
                borderColor: '#fff',
                hoverOffset: 10
              }
            ]
          }
        var pieChartCanvas = $('#pieChart').get(0).getContext('2d')
        var pieData        = donutData;
        var pieOptions     = {
          maintainAspectRatio : false,
          responsive : true,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                padding: 20,
                font: {
                  size: 14
                }
              }
            }
          }
        }
        //Create pie chart
        var pieChart = new Chart(pieChartCanvas, {
          type: 'doughnut',
          data: pieData,
          options: pieOptions      
        });

        var subject_list = {{ subject_list|safe|escape }};
        var attendance_list = {{ attendance_list }};
  
        var barChartData = {
          labels  : subject_list,
          datasets: [
            {
              label               : 'Attendance Count',
              backgroundColor     : 'rgba(79, 172, 254, 0.8)',
              borderColor         : '#4facfe',
              borderWidth         : 2,
              borderRadius        : 5,
              data                : attendance_list
            }
          ]
        }
        
        var barChartCanvas = $('#barChart').get(0).getContext('2d')
    
        var stackedBarChartOptions = {
          responsive              : true,
          maintainAspectRatio     : false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            x: {
              grid: {
                display: false
              }
            },
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(0, 0, 0, 0.05)'
              }
            }
          }
        }
    
        var barChart = new Chart(barChartCanvas, {
          type: 'bar', 
          data: barChartData,
          options: stackedBarChartOptions
        })
      })
  </script>
{% endblock custom_js %}
